<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>specialString æˆªå–</title>
  <script>
    const str = 'ğŸ˜ˆğŸ˜­ağŸ˜„ğŸ˜‡b'; // 4ä¸ªå­—ç¬¦
    console.log(str.length) // é•¿åº¦ä¸º 8  å–çš„æ˜¯å­—ç¬¦ä¸²çš„ ç å…ƒçš„é•¿åº¦
    console.log(str[0]) // ä¹±ç  ä¸‹æ ‡  ç å…ƒ 
    // console.log(str.slice(1,3)) // ä¹±ç  ä¸‹æ ‡  ç å…ƒ 

    

    // é‡å†™å­—ç¬¦ä¸²ç›¸å…³ æ–¹æ³•
    String.prototype.pointLength = function(){
      let len = 0;
      for (let i = 0; i < this.length;) {
        const codePoint = this.codePointAt(i)
        if(codePoint > 2**16 && codePoint <= 2**32) { // 2ä¸ªç å…ƒ +
          i += 2
        }else{
          i++
        }
        len++
        // ç®€å†™ codePoint > 0xffff ? 2 : 1
      }
      return len
    }
    // æ ¹æ®ç ç‚¹ä¸‹æ ‡ è¿”å›å­—ç¬¦
    String.prototype.pointAt = function(index) {
      let curIndex = 0; // ç ç‚¹ä¸‹æ ‡
      for (let i = 0; i < this.length;) {
        const codePoint = this.codePointAt(i)
        if(curIndex === index) { // 2ä¸ªç å…ƒ +
          return String.fromCodePoint(codePoint)
        }
        i += codePoint > 0xffff? 2 : 1;
        curIndex++;
        // ç®€å†™ codePoint > 0xffff ? 2 : 1
      }
    }

    // æ ¹æ®ç ç‚¹ èŠ‚ç‚¹
    String.prototype.sliceByPoint = function(start = 0, end = this.pointLength()) {
      let result = ''
      for (let i = start; i < end; i++) {
        result += this.pointAt(i);
      }
      return result;
    }

    console.log(str.pointLength())
    console.log(str.pointAt(1))
    console.log(str.sliceByPoint(0,4))
  </script>
</head>
<body>
  <h1>specialString æˆªå–</h1>
  éšç€äº’è”ç½‘çš„å‘å±•ï¼Œç‰¹æ®Šå­—ç¬¦å‡ºç°çš„é¢‘ç‡å˜é«˜ï¼Œä¾‹å¦‚emo è¡¨æƒ…ï¼ŒğŸ˜ˆ ğŸ˜­ ğŸ˜„ ğŸ˜‡,
  å¯¼è‡´å­—ç¬¦ä¸²é•¿åº¦è·å–ï¼Œæˆªå–ï¼Œä¸‹æ ‡ç­‰å¼‚äºå¸¸è§„ <br/>
  <ul>
  <li>js ç¼–ç UTF-16ï¼Œç‰¹æ®Šå­—ç¬¦1ä¸ªå­—ç¬¦ç¼–ç èŒƒå›´è¶…è¿‡2^16 èŒƒå›´ï¼Œå°†æ‹“å±•å­˜å‚¨ç©ºé—´ä¸º 32ä½Â·Â·Â·</li>
  <li>æ¯16ä½ä¸ºä¸€ä¸ªå­˜å‚¨å•å…ƒ-ç å…ƒï¼ˆcode unitï¼‰</li>
  <li>ä¸€ä¸ªå­—ç¬¦ç§°ä¸ºä¸€ä¸ªç ç‚¹ code pointï¼ˆå¯èƒ½å æœ‰å¤šä¸ªå­˜å‚¨å•å…ƒ</li>
  </ul>
</body>
</html>