<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta http-equiv="X-UA-Compatible" content="ie=edge">
<title>Markmap</title>
<style>
* {
  margin: 0;
  padding: 0;
}
#mindmap {
  display: block;
  width: 100vw;
  height: 100vh;
}
</style>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/markmap-toolbar@0.18.10/dist/style.css">
</head>
<body>
<svg id="mindmap"></svg>
<script src="https://cdn.jsdelivr.net/npm/d3@7.9.0/dist/d3.min.js"></script><script src="https://cdn.jsdelivr.net/npm/markmap-view@0.18.10/dist/browser/index.js"></script><script src="https://cdn.jsdelivr.net/npm/markmap-toolbar@0.18.10/dist/index.js"></script><script>(()=>{setTimeout(()=>{const{markmap:x,mm:K}=window,P=new x.Toolbar;P.attach(K);const F=P.render();F.setAttribute("style","position:absolute;bottom:20px;right:20px"),document.body.append(F)})})()</script><script>((b,L,T,D)=>{const H=b();window.mm=H.Markmap.create("svg#mindmap",(L||H.deriveOptions)(D),T)})(()=>window.markmap,null,{"content":"javascript的运行机制","children":[{"content":"一、为什么JavaScript是单线程？","children":[],"payload":{"tag":"h2","lines":"2,3"}},{"content":"二、任务队列","children":[],"payload":{"tag":"h2","lines":"10,11"}},{"content":"三、事件和回调函数","children":[],"payload":{"tag":"h2","lines":"32,33"}},{"content":"四、Event Loop","children":[],"payload":{"tag":"h2","lines":"42,43"}},{"content":"五、定时器","children":[],"payload":{"tag":"h2","lines":"72,73"}},{"content":"任务队列的类型与执行顺序","children":[{"content":"宏任务（Macro Task）","children":[{"content":"宏任务的定义与常见类型","children":[{"content":"<pre data-lines=\"115,125\"><code class=\"language-html\"><span class=\"hljs-meta\">&lt;!DOCTYPE <span class=\"hljs-keyword\">html</span>&gt;</span>  \n<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">html</span> <span class=\"hljs-attr\">lang</span>=<span class=\"hljs-string\">\"en\"</span>&gt;</span>  \n<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">head</span>&gt;</span>  \n  <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">meta</span> <span class=\"hljs-attr\">charset</span>=<span class=\"hljs-string\">\"UTF-8\"</span>&gt;</span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">head</span>&gt;</span>  \n<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">body</span>&gt;</span>  \n  <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">script</span>&gt;</span><span class=\"language-javascript\">      <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(<span class=\"hljs-string\">'这是整体脚本执行的宏任务'</span>);  \n  </span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">script</span>&gt;</span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">body</span>&gt;</span>  \n<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">html</span>&gt;</span>  \n</code></pre>","children":[],"payload":{"tag":"pre","lines":"115,125"}}],"payload":{"tag":"h4","lines":"107,108"}},{"content":"宏任务的执行特点与顺序","children":[{"content":"<pre data-lines=\"149,161\"><code class=\"language-javascript\"><span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(<span class=\"hljs-string\">'同步任务1'</span>);  \n<span class=\"hljs-built_in\">setTimeout</span>(<span class=\"hljs-function\">() =&gt;</span> {  \n  <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(<span class=\"hljs-string\">'宏任务1'</span>);  \n}, <span class=\"hljs-number\">0</span>);  \n  \n<span class=\"hljs-built_in\">setTimeout</span>(<span class=\"hljs-function\">() =&gt;</span> {  \n  <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(<span class=\"hljs-string\">'宏任务2'</span>);  \n}, <span class=\"hljs-number\">0</span>);  \n  \n<span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(<span class=\"hljs-string\">'同步任务2'</span>);  \n</code></pre>","children":[],"payload":{"tag":"pre","lines":"149,161"}}],"payload":{"tag":"h4","lines":"135,136"}}],"payload":{"tag":"h3","lines":"105,106"}},{"content":"微任务（Micro Task）","children":[{"content":"微任务的定义与常见类型","children":[{"content":"<pre data-lines=\"177,188\"><code class=\"language-javascript\"><span class=\"hljs-keyword\">const</span> promise = <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">Promise</span>(<span class=\"hljs-function\">(<span class=\"hljs-params\">resolve, reject</span>) =&gt;</span> {  \n  <span class=\"hljs-built_in\">setTimeout</span>(<span class=\"hljs-function\">() =&gt;</span> {      <span class=\"hljs-title function_\">resolve</span>(<span class=\"hljs-string\">'成功结果'</span>);  \n  }, <span class=\"hljs-number\">1000</span>);  \n});  \npromise.<span class=\"hljs-title function_\">then</span>(<span class=\"hljs-function\"><span class=\"hljs-params\">result</span> =&gt;</span> {  \n  <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(<span class=\"hljs-string\">'这是Promise的微任务回调'</span>, result);  \n}).<span class=\"hljs-title function_\">catch</span>(<span class=\"hljs-function\"><span class=\"hljs-params\">error</span> =&gt;</span> {  \n  <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">error</span>(<span class=\"hljs-string\">'Promise出错:'</span>, error);  \n});  \n</code></pre>","children":[],"payload":{"tag":"pre","lines":"177,188"}},{"content":"<pre data-lines=\"196,207\"><code class=\"language-javascript\"><span class=\"hljs-keyword\">const</span> targetNode = <span class=\"hljs-variable language_\">document</span>.<span class=\"hljs-title function_\">getElementById</span>(<span class=\"hljs-string\">'target'</span>);  \n<span class=\"hljs-keyword\">const</span> config = { <span class=\"hljs-attr\">attributes</span>: <span class=\"hljs-literal\">true</span> };  \n<span class=\"hljs-keyword\">const</span> observer = <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">MutationObserver</span>(<span class=\"hljs-function\">(<span class=\"hljs-params\">mutationsList</span>) =&gt;</span> {  \n  <span class=\"hljs-keyword\">for</span> (<span class=\"hljs-keyword\">const</span> mutation <span class=\"hljs-keyword\">of</span> mutationsList) {      <span class=\"hljs-keyword\">if</span> (mutation.<span class=\"hljs-property\">type</span> === <span class=\"hljs-string\">'attributes'</span>) {          <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(<span class=\"hljs-string\">'这是MutationObserver的微任务回调，属性已改变:'</span>, mutation.<span class=\"hljs-property\">attributeName</span>);  \n      }  }});  \n  \nobserver.<span class=\"hljs-title function_\">observe</span>(targetNode, config);  \n<span class=\"hljs-comment\">// 模拟属性改变  </span>\ntargetNode.<span class=\"hljs-title function_\">setAttribute</span>(<span class=\"hljs-string\">'data-test'</span>, <span class=\"hljs-string\">'new-value'</span>);  \n</code></pre>","children":[],"payload":{"tag":"pre","lines":"196,207"}},{"content":"<pre data-lines=\"213,220\"><code class=\"language-javascript\"><span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(<span class=\"hljs-string\">'同步任务'</span>);  \n<span class=\"hljs-title function_\">queueMicrotask</span>(<span class=\"hljs-function\">() =&gt;</span> {  \n  <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(<span class=\"hljs-string\">'这是通过queueMicrotask添加的微任务'</span>);  \n});  \n<span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(<span class=\"hljs-string\">'同步任务结束'</span>);  \n</code></pre>","children":[],"payload":{"tag":"pre","lines":"213,220"}}],"payload":{"tag":"h4","lines":"168,169"}},{"content":"微任务的执行特点与顺序","children":[{"content":"<pre data-lines=\"230,239\"><code class=\"language-javascript\"><span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(<span class=\"hljs-string\">'同步任务1'</span>);  \n<span class=\"hljs-title class_\">Promise</span>.<span class=\"hljs-title function_\">resolve</span>().<span class=\"hljs-title function_\">then</span>(<span class=\"hljs-function\">() =&gt;</span> {  \n  <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(<span class=\"hljs-string\">'微任务1'</span>);  \n  <span class=\"hljs-title class_\">Promise</span>.<span class=\"hljs-title function_\">resolve</span>().<span class=\"hljs-title function_\">then</span>(<span class=\"hljs-function\">() =&gt;</span> {  \n      <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(<span class=\"hljs-string\">'微任务2'</span>);  \n  });});  \n<span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(<span class=\"hljs-string\">'同步任务2'</span>);  \n</code></pre>","children":[],"payload":{"tag":"pre","lines":"230,239"}}],"payload":{"tag":"h4","lines":"222,223"}},{"content":"事件循环的完成流程","children":[{"content":"<pre data-lines=\"258,274\"><code class=\"language-js\"><span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(<span class=\"hljs-string\">\"Script Start\"</span>);  \n  \n<span class=\"hljs-built_in\">setTimeout</span>(<span class=\"hljs-function\">() =&gt;</span> <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(<span class=\"hljs-string\">\"Timeout\"</span>), <span class=\"hljs-number\">0</span>);  \n<span class=\"hljs-title class_\">Promise</span>.<span class=\"hljs-title function_\">resolve</span>()  \n  .<span class=\"hljs-title function_\">then</span>(<span class=\"hljs-function\">() =&gt;</span> <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(<span class=\"hljs-string\">\"Promise 1\"</span>))  \n  .<span class=\"hljs-title function_\">then</span>(<span class=\"hljs-function\">() =&gt;</span> <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(<span class=\"hljs-string\">\"Promise 2\"</span>));  \n  \n<span class=\"hljs-title function_\">requestAnimationFrame</span>(<span class=\"hljs-function\">() =&gt;</span> <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(<span class=\"hljs-string\">\"rAF\"</span>));  \n<span class=\"hljs-variable language_\">document</span>.<span class=\"hljs-title function_\">addEventListener</span>(<span class=\"hljs-string\">\"click\"</span>, <span class=\"hljs-function\">() =&gt;</span> <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(<span class=\"hljs-string\">\"Click\"</span>));  \n<span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(<span class=\"hljs-string\">\"Script End\"</span>);  \n<span class=\"hljs-comment\">// 输出顺序：  </span>\n<span class=\"hljs-comment\">// Script Start → Script End → Promise 1 → Promise 2 → rAF → Timeout  </span>\n<span class=\"hljs-comment\">// （点击页面后输出 Click）  </span>\n  \n</code></pre>","children":[],"payload":{"tag":"pre","lines":"258,274"}}],"payload":{"tag":"h4","lines":"246,247"}}],"payload":{"tag":"h3","lines":"167,168"}}],"payload":{"tag":"h2","lines":"103,104"}},{"content":"四、浏览器事件循环机制的工作流程","children":[{"content":"初始执行阶段","children":[{"content":"<pre data-lines=\"286,297\"><code class=\"language-html\"><span class=\"hljs-meta\">&lt;!DOCTYPE <span class=\"hljs-keyword\">html</span>&gt;</span>  \n<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">html</span> <span class=\"hljs-attr\">lang</span>=<span class=\"hljs-string\">\"en\"</span>&gt;</span>  \n<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">head</span>&gt;</span>  \n  <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">meta</span> <span class=\"hljs-attr\">charset</span>=<span class=\"hljs-string\">\"UTF-8\"</span>&gt;</span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">head</span>&gt;</span>  \n<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">body</span>&gt;</span>  \n  <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">script</span>&gt;</span><span class=\"language-javascript\">      <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(<span class=\"hljs-string\">'同步任务1'</span>);  \n      <span class=\"hljs-keyword\">function</span> <span class=\"hljs-title function_\">add</span>(<span class=\"hljs-params\">a, b</span>) {          <span class=\"hljs-keyword\">return</span> a + b;      }      <span class=\"hljs-keyword\">var</span> result = <span class=\"hljs-title function_\">add</span>(<span class=\"hljs-number\">3</span>, <span class=\"hljs-number\">4</span>);      <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(<span class=\"hljs-string\">'计算结果:'</span>, result);  \n  </span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">script</span>&gt;</span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">body</span>&gt;</span>  \n<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">html</span>&gt;</span>  \n</code></pre>","children":[],"payload":{"tag":"pre","lines":"286,297"}},{"content":"<pre data-lines=\"302,313\"><code class=\"language-javascript\"><span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(<span class=\"hljs-string\">'同步任务2'</span>);  \n  \n<span class=\"hljs-built_in\">setTimeout</span>(<span class=\"hljs-function\">() =&gt;</span> {  \n  \n  <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(<span class=\"hljs-string\">'异步任务（setTimeout）'</span>);  \n  \n}, <span class=\"hljs-number\">1000</span>);  \n  \n<span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(<span class=\"hljs-string\">'同步任务3'</span>);  \n</code></pre>","children":[],"payload":{"tag":"pre","lines":"302,313"}}],"payload":{"tag":"h3","lines":"280,281"}},{"content":"事件循环阶段","children":[{"content":"<pre data-lines=\"324,336\"><code class=\"language-javascript\"><span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(<span class=\"hljs-string\">'同步任务4'</span>);  \n<span class=\"hljs-built_in\">setTimeout</span>(<span class=\"hljs-function\">() =&gt;</span> {  \n  <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(<span class=\"hljs-string\">'宏任务1'</span>);  \n  <span class=\"hljs-title class_\">Promise</span>.<span class=\"hljs-title function_\">resolve</span>().<span class=\"hljs-title function_\">then</span>(<span class=\"hljs-function\">() =&gt;</span> {  \n      <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(<span class=\"hljs-string\">'宏任务中的微任务1'</span>);  \n  });}, <span class=\"hljs-number\">0</span>);  \n<span class=\"hljs-title class_\">Promise</span>.<span class=\"hljs-title function_\">resolve</span>().<span class=\"hljs-title function_\">then</span>(<span class=\"hljs-function\">() =&gt;</span> {  \n  <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(<span class=\"hljs-string\">'微任务1'</span>);  \n});  \n<span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(<span class=\"hljs-string\">'同步任务5'</span>);  \n</code></pre>","children":[],"payload":{"tag":"pre","lines":"324,336"}}],"payload":{"tag":"h3","lines":"316,317"}}],"payload":{"tag":"h2","lines":"278,279"}}],"payload":{"tag":"h1","lines":"0,1"}},null)</script>
</body>
</html>
